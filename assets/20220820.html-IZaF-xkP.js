import{_ as l,c as i,a as s,d as a,e as p,b as t,o,r}from"./app-Bq_Zj9jQ.js";const c="/assets/20220820-Dh6MK8WX.png",u={},d={href:"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share-timeline.html",target:"_blank",rel:"noopener noreferrer"},k={href:"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share.html",target:"_blank",rel:"noopener noreferrer"},v={href:"https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onshareappmessageobject-object",target:"_blank",rel:"noopener noreferrer"},m={href:"https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onshareappmessageobject-object",target:"_blank",rel:"noopener noreferrer"},g={href:"https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onshareappmessageobject-object",target:"_blank",rel:"noopener noreferrer"},b={href:"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share.html",target:"_blank",rel:"noopener noreferrer"},h={href:"https://zhaomenghuan.js.org/blog/wechat-miniprogram-principle-analysis.html#%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B",target:"_blank",rel:"noopener noreferrer"},f={href:"https://mp.weixin.qq.com/s/i5fNoUiMfi_k2KB-_DiKTg",target:"_blank",rel:"noopener noreferrer"},y={href:"https://github.com/NervJS/taro/issues/7470",target:"_blank",rel:"noopener noreferrer"},x={href:"https://www.jianshu.com/p/d7d415de71a8",target:"_blank",rel:"noopener noreferrer"},w={href:"https://segmentfault.com/a/1190000039799975",target:"_blank",rel:"noopener noreferrer"},j={href:"https://developers.weixin.qq.com/community/develop/doc/000c0afa8ec3c02fa29857d7256000",target:"_blank",rel:"noopener noreferrer"},q={href:"https://tech.youzan.com/weapp-booting/",target:"_blank",rel:"noopener noreferrer"},A={href:"https://developers.weixin.qq.com/community/develop/doc/000c48f4af01d07fbad797d3651800",target:"_blank",rel:"noopener noreferrer"};function P(S,n){const e=r("ExternalLinkIcon");return o(),i("div",null,[n[31]||(n[31]=s("h2",{id:"小程序分享配置介绍",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#小程序分享配置介绍"},[s("span",null,"小程序分享配置介绍")])],-1)),s("p",null,[n[2]||(n[2]=a("在小程序中的分享功能，官方文档中包含了")),s("a",d,[n[0]||(n[0]=a("分享到朋友圈")),p(e)]),n[3]||(n[3]=a("及")),s("a",k,[n[1]||(n[1]=a("转发")),p(e)]),n[4]||(n[4]=a("给好友及群聊两种 这里主要探讨小程序的分享。 首先看下普通分享，即“转发”，通过阅读文档发现小程序没有提供配置全局分享信息的方法，且默认是没有开启页面分享的 开启方式："))]),s("ul",null,[s("li",null,[n[6]||(n[6]=a("page添加")),s("a",v,[n[5]||(n[5]=a("onShareAppMessage")),p(e)]),n[7]||(n[7]=a("参数（函数）"))])]),n[32]||(n[32]=s("p",null,"触发方式：",-1)),s("ul",null,[n[11]||(n[11]=s("li",null,"点击右上角 --> 选择转发给朋友(menu)",-1)),s("li",null,[n[9]||(n[9]=a('点击含有open-type="share"属性的button，会触发页面的')),s("a",m,[n[8]||(n[8]=a("onShareAppMessage")),p(e)]),n[10]||(n[10]=a(" 事件(事件触发时执行) (button)"))])]),n[33]||(n[33]=t(`<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token function">onShareAppMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> app_version_info <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">&#39;app_version_info&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">title</span><span class="token operator">:</span> app_version_info<span class="token punctuation">.</span>title<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">imageUrl</span><span class="token operator">:</span> <span class="token string">&quot;https://select-oil-oss.vchangyi.com/wxapp/share-img.png&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1)),s("p",null,[s("a",g,[n[12]||(n[12]=a("onShareAppMessage")),p(e)]),n[13]||(n[13]=a("函数在")),n[14]||(n[14]=s("strong",null,"点击分享菜单",-1)),n[15]||(n[15]=a("或")),n[16]||(n[16]=s("strong",null,"点击button",-1)),n[17]||(n[17]=a("时触发，点击分享菜单如下所示 ")),n[18]||(n[18]=s("img",{src:"https://cdn.nlark.com/yuque/0/2022/png/1080807/1652102763844-7540ee5e-f44c-4069-8c1f-6abe1c272e2d.png#averageHue=%23c8c8c8&clientId=u6fb6bf53-e101-4&from=paste&height=286&id=BJ6nK&originHeight=422&originWidth=398&originalType=binary&ratio=1&rotation=0&showTitle=true&size=20241&status=done&style=none&taskId=u425cf322-b707-44f8-8d58-6d9ea0c6f9a&title=图1-点击分享菜单（发送给朋友）&width=269.40000915527344",alt:"图1-点击分享菜单（发送给朋友）",title:"图1-点击分享菜单（发送给朋友）"},null,-1)),n[19]||(n[19]=a(" 当onShareAppMessage为空函数时，即没有返回配置对象时，微信小程序会自动设置默认分享配置，小程序名作为转发标题，高度为80% 屏幕宽度的图像作为转发图片。"))]),n[34]||(n[34]=t(`<h2 id="小程序隐藏api-onapproute-eventlistener" tabindex="-1"><a class="header-anchor" href="#小程序隐藏api-onapproute-eventlistener"><span>小程序隐藏API onAppRoute(eventListener)</span></a></h2><p>在小程序切换页面或打开页面时会触发onAppRoute 事件，小程序框架通过wx.onAppRoute 可以注册页面切换时的处理程序，一般开发放在app.js的onLunch生命周期中全局注册一次即可，可用于监听页面切换。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  wx<span class="token punctuation">.</span><span class="token function">onAppRoute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过对查看route，个人总结如下</p><p><img src="`+c+'"></p><h2 id="小程序不同场景需求配置分享的策略" tabindex="-1"><a class="header-anchor" href="#小程序不同场景需求配置分享的策略"><span>小程序不同场景需求配置分享的策略</span></a></h2><h3 id="_1-官方配置思路" tabindex="-1"><a class="header-anchor" href="#_1-官方配置思路"><span>1. 官方配置思路</span></a></h3>',7)),s("p",null,[n[21]||(n[21]=a("官方的配置思路是，哪个页面需要，哪个页面添加，不添加则不开启分享 适用场景：当前项目仅部分页面需要配置分享，如活动页面，并可携带动态参数。如果在打开分享后，需要获取更多场景信息，如群标识，见")),s("a",b,[n[20]||(n[20]=a("此官方文档")),p(e)]),n[22]||(n[22]=a("。"))]),n[35]||(n[35]=t(`<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token function">onShareAppMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">title</span><span class="token operator">:</span> app_version_info<span class="token punctuation">.</span>title<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">imageUrl</span><span class="token operator">:</span> <span class="token string">&quot;https://select-oil-oss.vchangyi.com/wxapp/share-img.png&quot;</span></span>
<span class="line">      <span class="token literal-property property">path</span><span class="token operator">:</span><span class="token string">&#39;xxxx?xx=aa&#39;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-全局默认分享、全局自定义分享、全局开启分享且部分页面自定义分享-8" tabindex="-1"><a class="header-anchor" href="#_2-全局默认分享、全局自定义分享、全局开启分享且部分页面自定义分享-8"><span>2. 全局默认分享、全局自定义分享、全局开启分享且部分页面自定义分享[8]</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">//在App.js 开头处写入如下立即执行函数表达式</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> PageTmp <span class="token operator">=</span> Page<span class="token punctuation">;</span></span>
<span class="line">  <span class="token function-variable function">Page</span> <span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">pageConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 设置全局默认分享</span></span>
<span class="line">    pageConfig <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token function-variable function">onShareAppMessage</span><span class="token operator">:</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">&#39;默认文案&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">path</span><span class="token operator">:</span><span class="token string">&#39;默认分享路径+id&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">imageUrl</span><span class="token operator">:</span><span class="token string">&#39;默认分享图片&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>pageConfig<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">PageTmp</span><span class="token punctuation">(</span>pageConfig<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token doc-comment comment">/**解释下上述代码做了什么</span>
<span class="line">  在小程序初始化启动时，在上下文中立即执行上述代码，Page函数被赋值给PageTmp变量</span>
<span class="line">  然后Page函数被重写，该函数接受原有初始化Page的Object参数，并添加了onShareAppMessage参数（函数）</span>
<span class="line">  然后再调用PageTmp（真正的Page函数），并传修改后的配置对象参数</span>
<span class="line">  IIEF在初始化执行完后立即被销毁，所以功能上完成的重写Page的作用，类似于执行前的拦截</span>
<span class="line">  当在某个页面写了onShareAppMessage时，由于assign在后面，所以页面配置会替换默认配置</span>
<span class="line">  开启全局默认分享即不自定义分享信息、部分页面自定义分享需要在页面自行添加onShareAppMessage函数。</span>
<span class="line">*/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-仅开启部分页面分享且分享信息一致-一次配置策略" tabindex="-1"><a class="header-anchor" href="#_3-仅开启部分页面分享且分享信息一致-一次配置策略"><span>3. 仅开启部分页面分享且分享信息一致，一次配置策略</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// 使用behaviors 统一配置，在需要的页面引入</span></span>
<span class="line"><span class="token comment">// ./behaviors/share-config.js</span></span>
<span class="line"><span class="token comment">// eslint-disable-next-line no-undef</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">Behavior</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">	<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">onShareAppMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">				<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;测试分享标题&#39;</span><span class="token punctuation">,</span></span>
<span class="line">				<span class="token literal-property property">imageUrl</span><span class="token operator">:</span> <span class="token string">&#39;https://select-oil-oss.vchangyi.com/wxapp/share-img.png&#39;</span><span class="token punctuation">,</span></span>
<span class="line">			<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//./pages/home/home.js</span></span>
<span class="line"><span class="token keyword">var</span> shareConfigBehavior <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../../behaviors/share-config.js&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">	<span class="token literal-property property">behaviors</span><span class="token operator">:</span> <span class="token punctuation">[</span>shareConfigBehavior<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">//...</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参考：</p>`,6)),s("ol",null,[s("li",null,[s("a",h,[n[23]||(n[23]=a("微信小程序原理分析 - 匠心博客")),p(e)])]),s("li",null,[s("a",f,[n[24]||(n[24]=a("从源码看微信小程序启动过程 - 有赞coder 公众号")),p(e)])]),s("li",null,[s("a",y,[n[25]||(n[25]=a("taro - issues-7470")),p(e)])]),s("li",null,[s("a",x,[n[26]||(n[26]=a("微信小程序全局分享转发控制实现——从此无需页面单独配置 - 简书")),p(e)])]),s("li",null,[s("a",w,[n[27]||(n[27]=a("小程序的全局分享方法onShareAppMessage - segmentfault")),p(e)])]),s("li",null,[s("a",j,[n[28]||(n[28]=a("谈一谈隐藏路由回调API wx.onAppRoute - 微信开放社区")),p(e)])]),s("li",null,[s("a",q,[n[29]||(n[29]=a("从源码看微信小程序启动过程 - 有赞团队")),p(e)])]),s("li",null,[s("a",A,[n[30]||(n[30]=a("关于小程序全局分享 - 微信开放社区")),p(e)])])])])}const T=l(u,[["render",P],["__file","20220820.html.vue"]]),B=JSON.parse('{"path":"/blogs/Frontend/20220820.html","title":"小程序中如何实现自定义分享？","lang":"en-US","frontmatter":{"title":"小程序中如何实现自定义分享？","date":"2022-08-20T00:00:00.000Z","tags":["微信小程序"],"categories":["Frontend"]},"headers":[{"level":2,"title":"小程序分享配置介绍","slug":"小程序分享配置介绍","link":"#小程序分享配置介绍","children":[]},{"level":2,"title":"小程序隐藏API onAppRoute(eventListener)","slug":"小程序隐藏api-onapproute-eventlistener","link":"#小程序隐藏api-onapproute-eventlistener","children":[]},{"level":2,"title":"小程序不同场景需求配置分享的策略","slug":"小程序不同场景需求配置分享的策略","link":"#小程序不同场景需求配置分享的策略","children":[{"level":3,"title":"1. 官方配置思路","slug":"_1-官方配置思路","link":"#_1-官方配置思路","children":[]},{"level":3,"title":"2. 全局默认分享、全局自定义分享、全局开启分享且部分页面自定义分享[8]","slug":"_2-全局默认分享、全局自定义分享、全局开启分享且部分页面自定义分享-8","link":"#_2-全局默认分享、全局自定义分享、全局开启分享且部分页面自定义分享-8","children":[]},{"level":3,"title":"3. 仅开启部分页面分享且分享信息一致，一次配置策略","slug":"_3-仅开启部分页面分享且分享信息一致-一次配置策略","link":"#_3-仅开启部分页面分享且分享信息一致-一次配置策略","children":[]}]}],"git":{"createdTime":1753180835000,"updatedTime":1753180835000,"contributors":[{"name":"wanggang","email":"1587254004@qq.com","commits":1}]},"filePathRelative":"blogs/Frontend/20220820.md"}');export{T as comp,B as data};
